% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mvjagam.R
\name{mvjagam}
\alias{mvjagam}
\title{Fit a Bayesian multivariate GAM to a set of discrete time series}
\usage{
mvjagam(
  formula,
  data_train,
  data_test,
  use_nb = TRUE,
  use_mv = FALSE,
  n.adapt = 1000,
  n.chains = 2,
  n.burnin = 5000,
  n.iter = 2000,
  thin = 2,
  auto_update = TRUE,
  phi_prior = "dbeta(1, 1)",
  rho_prior = "dunif(-12, 12)",
  r_prior = "dexp(0.001)",
  tau_prior = "dunif(1, 100)"
)
}
\arguments{
\item{formula}{A \code{character} string specifying the GAM formula. These are exactly like the formula
for a GLM except that smooth terms, s, te, ti and t2, can be added to the right hand side
to specify that the linear predictor depends on smooth functions of predictors (or linear functionals of these).}

\item{data_train}{A\code{dataframe} containing the model response variable and covariates
required by the GAM \code{formula}. Should include columns:
'y' (the discrete outcomes; NAs allowed)
'series' (character or factor index of the series IDs)
'season' (numeric index of the seasonal time point for each observation; should not have any missing)
'year' the numeric index for year
'in_season' indicator for whether the observation is in season or not. If the counts tend to go to zero
during the off season (as in tick counts for example), setting this to zero can be useful as trends won't contribute during
during this time but they continue to evolve, allowing the trend from the past season to continue evolving rather than forcing
it to zero
Any other variables to be included in the linear predictor of \code{formula} must also be present}

\item{data_test}{\code{dataframe} containing at least 'series', 'season', 'year' and 'in_season' for the forecast horizon, in
addition to any other variables included in the linear predictor of \code{formula}}

\item{use_nb}{\code{logical} If \code{TRUR}, use a Negative Binomial likelihood with estimated
overdispersion parameter r;
if \code{FALSE}, set r to \code{10,000} to approximate the Poisson distribution}

\item{use_mv}{\code{logical} If \code{TRUE} and the total number of series is \code{<=5},
a multivariate gaussian distribution is used for the state space trend errors. If \code{TRUE} and the total number
of series is \code{>5}, a set of latent dynamic factors is estimated to capture possible dependencies in the state
space trends. If \code{FALSE}, independent gaussian distributions are used for the trends}

\item{n.adapt}{\code{integer} the number of iterations for adaptation. See adapt for details.
If \code{n.adapt} = 0 then no adaptation takes place}

\item{n.chains}{\code{integer} the number of parallel chains for the model}

\item{n.iter}{\code{integer} the number of iterations of the Markov chain to run}

\item{auto_update}{\code{logical} If \code{TRUE}, the model is run for up to \code{3} additional sets of
\code{n.iter} iterations, or until the lower 15\% of effective sample sizes reaches \code{100}}

\item{phi_prior}{\code{character} specifying (in JAGS syntax) the prior distributions for the AR1 coefficients in the
latent trends}

\item{rho_prior}{\code{character} specifying (in JAGS syntax) the prior distributions for the smooth penalty parameters}

\item{r_prior}{\code{character} specifying (in JAGS syntax) the prior distribution for the Negative Binomial
overdispersion parameter}

\item{tau_prior}{\code{character} specifying (in JAGS syntax) the prior distributions for the independent gaussian
precisions used for the latent trends (ignored if \code{use_mv == TRUE})}
}
\value{
A \code{list} object containing JAGS model output, the text representation of the model file,
the mgcv model output (for easily generating simulations at
unsampled covariate values), the names of the smooth parameters and the matrix of indices for each series
}
\description{
This function estimates the posterior distribution for a multivariate GAM that includes
smooth seasonality and possible other smooth functions specified in the GAM formula. State-space latent trends
are estimated for each series, with a number of options for specifying the structures of the trends
}
\details{
A \code{\link[mcgv]{jagam}} model file is generated from \code{formula} and modified to include the latent
AR1 state space trends. The model parameters are esimated in a Bayesian framework using Gibbs sampling
in \code{\link[rjags]{jags.model}}.
}
