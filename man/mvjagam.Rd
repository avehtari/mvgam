% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mvjagam.R
\name{mvjagam}
\alias{mvjagam}
\title{Fit a Bayesian multivariate GAM to a set of discrete time series}
\usage{
mvjagam(
  formula,
  data_train,
  data_test,
  prior_simulation = FALSE,
  use_nb = TRUE,
  use_mv = FALSE,
  use_lv = FALSE,
  n_lv = 5,
  n.adapt = 1000,
  n.chains = 2,
  n.burnin = 5000,
  n.iter = 2000,
  thin = 2,
  auto_update = TRUE,
  phi_prior,
  r_prior = "dexp(0.001)",
  tau_prior
)
}
\arguments{
\item{formula}{A \code{character} string specifying the GAM formula. These are exactly like the formula
for a GLM except that smooth terms, s, te, ti and t2, can be added to the right hand side
to specify that the linear predictor depends on smooth functions of predictors (or linear functionals of these).}

\item{data_train}{A \code{dataframe} containing the model response variable and covariates
required by the GAM \code{formula}. Should include columns:
'y' (the discrete outcomes; NAs allowed)
'series' (character or factor index of the series IDs)
'season' (numeric index of the seasonal time point for each observation; should not have any missing)
'year' the numeric index for year, and
'in_season' indicator for whether the observation is in season or not. If the counts tend to go to zero
during the off season (as in tick counts for example), setting 'in_season' to zero cduring these seasonal periods
can be useful as trends won't contribute during
during this time but they continue to evolve, allowing the trend to continue evolving rather than forcing
it to zero during the off-season
Any other variables to be included in the linear predictor of \code{formula} must also be present}

\item{data_test}{A \code{dataframe} containing at least 'series', 'season', 'year' and 'in_season' for the forecast horizon, in
addition to any other variables included in the linear predictor of \code{formula}}

\item{prior_simulation}{\code{logical}. If \code{TRUE}, no observations are fed to the model, and instead
simulations from prior distributions are returned}

\item{use_nb}{\code{logical} If \code{TRUR}, use a Negative Binomial likelihood with estimated
overdispersion parameter r;
if \code{FALSE}, set r to \code{10,000} to approximate the Poisson distribution}

\item{use_mv}{\code{logical} If \code{TRUE} and \code{use_lv = FALSE},
a multivariate gaussian distribution is used for the state space trend errors. If \code{TRUE} and \code{use_lv = TRUE},
space trends. If \code{FALSE}, independent gaussian distributions are used for the trend errors}

\item{use_lv}{\code{logical} If \code{TRUE}, use latent dynamic factors to estimate correlations in series'
latent trends. If \code{FALSE}, estimate covarying errors in the latent trends}

\item{n_lv}{\code{integer} the number of latent dynamic factors to use if \code{use_mv == TRUE}
and \code{use_lv == TRUE}. Cannot be \code{>n_series}. Defaults to \code{min(5, floor(n_series / 2))},
which should provide enough information to estimate correlations among latend factor loadings}

\item{n.adapt}{\code{integer} the number of iterations for adaptation. See adapt for details.
If \code{n.adapt} = 0 then no adaptation takes place}

\item{n.chains}{\code{integer} the number of parallel chains for the model}

\item{n.iter}{\code{integer} the number of iterations of the Markov chain to run}

\item{auto_update}{\code{logical} If \code{TRUE}, the model is run for up to \code{3} additional sets of
\code{n.iter} iterations, or until the lower 15th percentile of effective sample sizes reaches \code{100}}

\item{phi_prior}{\code{character} specifying (in JAGS syntax) the prior distributions for the drift terms in the
latent trends}

\item{r_prior}{\code{character} specifying (in JAGS syntax) the prior distribution for the Negative Binomial
overdispersion parameter}

\item{tau_prior}{\code{character} specifying (in JAGS syntax) the prior distributions for the independent gaussian
precisions used for the latent trends (ignored if \code{use_mv == TRUE})}
}
\value{
A \code{list} object containing JAGS model output, the text representation of the model file,
the mgcv model output (for easily generating simulations at
unsampled covariate values), the names of the smooth parameters and the matrix of indices for each series
}
\description{
This function estimates the posterior distribution for a multivariate GAM that includes
smooth seasonality and possible other smooth functions specified in the GAM formula. State-space latent trends
(random walks with drift)are estimated for each series, with a number of options for specifying the
structures of the trends
}
\details{
A \code{\link[mcgv]{jagam}} model file is generated from \code{formula} and modified to include the latent
AR1 state space trends. The model parameters are esimated in a Bayesian framework using Gibbs sampling
in \code{\link[rjags]{jags.model}}.
}
