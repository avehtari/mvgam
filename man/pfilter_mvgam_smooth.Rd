% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pfilter_mvgam_smooth.R
\name{pfilter_mvgam_smooth}
\alias{pfilter_mvgam_smooth}
\title{Assimilate new observations into a fitted mvgam model using resampling and kernel smoothing}
\usage{
pfilter_mvgam_smooth(
  particles,
  mgcv_model,
  next_assim,
  threshold = 0.5,
  n_cores = parallel::detectCores() - 1,
  use_resampling = FALSE,
  kernel_lambda = 1
)
}
\arguments{
\item{particles}{A \code{list} of particles that have been run up to one observation prior to the observation
in \code{next_assim}}

\item{mgcv_model}{A \code{\link[mgcv]{gam}} model returned through a call to \code{link{mvjagam}}}

\item{next_assim}{A \code{dataframe} of test data containing at one more observation per series
(beyond the last observation seen by the model when initialising particles with
\code{\link{pfilter_mvgam_init}} or in previous calls to \code{pfilter_mvgam_online}.
Should at least contain 'series', 'season', 'year' and in_season' for the one-step ahead horizon,
in addition to any other variables included in the linear predictor of \code{object}}

\item{threshold}{\code{proportional numeric} specifying the Effective Sample Size limit under which
resampling of particles will be triggered (calculated as \code{ESS / n_particles}) if \code{use_resampling == TRUE}.
Should be between \code{0} and \code{1}}

\item{n_cores}{\code{integer} specifying number of cores for generating particle forecasts in parallel}

\item{use_resampling}{\code{logical} specifying whether resampling should be used when ESS falls below
the specified \code{threshold}. Note that resampling can result in loss of the original model's diversity of
GAM beta coefficients, which may have undesirable consequences for the forecast distribution. If
\code{use_resampling} is \code{TRUE}, some effort is made to remedy this by assigning randomly sampled draws of
beta coefficients from the original model's distribution to each particle. This does not however guarantee that there
will be no loss of diversity, especially if successive resamples take place. Default for this option is therefore
\code{FALSE}}

\item{kernel_lambda}{\code{proportional numeric} specifying the strength of kernel smoothing to use when
pulling low weight particles toward the high likelihood state space. Should be between \code{0} and \code{1}}

\item{file_path}{\code{character} string specifying the file path for locating the particles}
}
\value{
A \code{list} object of \code{length = n_particles} containing information on parameters and
current state estimates for each particle
}
\description{
This function operates on a new observation in \code{next_assim} to update the
posterior forecast distribution. The next observation is assimilated
and particle weights are updated in light of their most recent their multivariate composite likelihood.
Low weight particles are smoothed towards the high weight state space using kernel smoothing, and options are
given for using resampling of high weight particles when Effective Sample Size falls below a
user-specified threshold
}
